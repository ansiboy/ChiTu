!function(a){"function"==typeof define&&define.amd?define(["jquery","hammer","move"],a):a($,Hammer,move)}(function(a,b,c){var d;!function(b){var c=b.Errors,d=function(){function d(c,d,e){if(!c)throw b.Errors.argumentNull("controller");if(!d)throw b.Errors.argumentNull("name");if(!e)throw b.Errors.argumentNull("handle");if(!a.isFunction(e))throw b.Errors.paramTypeError("handle","Function");this._name=d,this._handle=e}return d.prototype.name=function(){return this._name},d.prototype.execute=function(d,e){if(!d)throw c.argumentNull("page");var f=this._handle.apply({},[d].concat(e));return b.Utility.isDeferred(f)?f:a.Deferred().resolve()},d}();b.Action=d}(d||(d={}));var d;!function(b){var c=function(){function a(){this.path_string="",this.path_spliter_char="_",this.param_spliter="?",this._actionPath="",this._viewPath="",this._cssPath="",this._parameters={},this._pageName="",this.pathBase=""}return a.prototype.pareeUrl=function(a){if(!a)throw b.Errors.argumentNull("url");var c=document.createElement("a");c.href=a,c.search&&c.search.length>1&&(this._parameters=this.pareeUrlQuery(c.search.substr(1))),c.hash&&c.hash.length>1&&(this._pageName=c.hash.substr(1));var d=c.hash.substr(1).split(this.path_spliter_char);if(d.length<2)throw b.Errors.canntParseUrl(a);var e=d.join("/"),f=d.join("."),g={actionPath:this.pathBase+e+".js",viewPath:this.pathBase+e+".html",cssPath:this.pathBase+e+".css",parameters:{},pageName:f,controller:d[0],action:d[1]};return g},a.prototype.pareeUrlQuery=function(a){for(var b,c=/\+/g,d=/([^&=]+)=?([^&]*)/g,e=function(a){return decodeURIComponent(a.replace(c," "))},f={};b=d.exec(a);)f[e(b[1])]=e(b[2]);return f},a}();b.UrlParser=c;var d=10,e=function(){function e(d){if(this.pageCreating=b.Callbacks(),this.pageCreated=b.Callbacks(),this._runned=!1,this.container_stack=new Array,null==d)throw b.Errors.argumentNull("container");this._config=d,this._config.openSwipe=d.openSwipe||function(a){return b.SwipeDirection.None},this._config.closeSwipe=d.closeSwipe||function(a){return b.SwipeDirection.None},this._config.container=d.container||a.proxy(function(a,c){return b.PageContainerFactory.createInstance(this.app,a,c)},{app:this}),this._config.urlParser=this._config.urlParser||new c}return e.prototype.on_pageCreating=function(){return b.fireCallback(this.pageCreating,[this])},e.prototype.on_pageCreated=function(a){return b.fireCallback(this.pageCreated,[this,a])},Object.defineProperty(e.prototype,"config",{get:function(){return this._config},enumerable:!0,configurable:!0}),e.prototype.currentPage=function(){return this.container_stack.length>0?this.container_stack[this.container_stack.length-1].currentPage:null},Object.defineProperty(e.prototype,"pageContainers",{get:function(){return this.container_stack},enumerable:!0,configurable:!0}),e.prototype.createPageContainer=function(a){var c=this.config.container(a,this.pageContainers[this.pageContainers.length-1]);if(this.container_stack.push(c),this.container_stack.length>d){var e=this.container_stack.shift();e.close(b.SwipeDirection.None)}return c},e.prototype.hashchange=function(){if(1==window.location.skip)return void(window.location.skip=!1);var b;this.back_deferred&&null==this.back_deferred.processed&&(b=this.back_deferred,b.processed=!0);var c=window.location.hash;if(!c||c==this.start_flag_hash)return c||console.log("The url is not contains hash.url is "+window.location.href),c==this.start_flag_hash&&(window.history.pushState({},"",this.start_hash),console.log("The hash is start url, the hash is "+c)),void(b&&b.reject());this.start_flag_hash||(this.start_flag_hash="#AABBCCDDEEFF",this.start_hash=c,window.history.replaceState({},"",this.start_flag_hash),window.history.pushState({},"",c));var d=location.href,e=this.config.urlParser.pareeUrl(d),f=this.getPage(e.pageName),g=null!=f?f.container:null;if(null!=g&&a.inArray(g,this.container_stack)==this.container_stack.length-2){var h=this.container_stack.pop(),i=this.config.closeSwipe(h.currentPage.routeData);null!=h.previous&&(h.previous.visible=!0),h.close(i)}else{var j=window.location.arguments||{};window.location.arguments=null,this.showPage(d,j)}b&&b.resolve()},e.prototype.run=function(){if(!this._runned){a.proxy(this.hashchange,this)(),a(window).bind("hashchange",a.proxy(this.hashchange,this)),this._runned=!0}},e.prototype.getPage=function(a){for(var b=this.container_stack.length-1;b>=0;b--){var c=this.container_stack[b].pages[a];if(null!=c)return c}return null},e.prototype.showPage=function(a,c){var d=this;if(!a)throw b.Errors.argumentNull("url");var e=this.config.urlParser.pareeUrl(a);if(null==e)throw b.Errors.noneRouteMatched(a);var f=this.createPageContainer(e);f.pageCreated.add(function(a,b){return d.on_pageCreated(b)});var g=this.config.openSwipe(e),h=f.showPage(e,c,g);return h},e.prototype.createPageNode=function(){var a=document.createElement("div");return a},e.prototype.redirect=function(a,b){return window.location.skip=!0,window.location.hash=a,this.showPage(a,b)},e.prototype.back=function(b){return void 0===b&&(b=void 0),this.back_deferred=a.Deferred(),0==window.history.length?(this.back_deferred.reject(),this.back_deferred):(window.history.back(),this.back_deferred)},e}();b.Application=e}(d||(d={}));var d,e=this&&this.__extends||function(a,b){function c(){this.constructor=a}for(var d in b)b.hasOwnProperty(d)&&(a[d]=b[d]);a.prototype=null===b?Object.create(b):(c.prototype=b.prototype,new c)};!function(b){var c;!function(a){a[a.ios=0]="ios",a[a.android=1]="android",a[a.other=2]="other"}(c||(c={}));var d={div:"div",iscroll:"iscroll",doc:"doc"},f=function(){function a(){var a=navigator.userAgent;if(a.indexOf("iPhone")>0||a.indexOf("iPad")>0){this._os=c.ios;var b=a.match(/iPhone OS\s([0-9\-]*)/);if(b){var d=parseInt(b[1],10);this._version=d}}else if(a.indexOf("Android")>0){this._os=c.android;var b=a.match(/Android\s([0-9\.]*)/);if(b){var d=parseInt(b[1],10);this._version=d}}else this._os=c.other}return Object.defineProperty(a.prototype,"osVersion",{get:function(){return this._version},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"os",{get:function(){return this._os},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isIOS",{get:function(){return this.os==c.ios},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isAndroid",{get:function(){return this.os==c.android},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isDegrade",{get:function(){return(this.isWeiXin||this.osVersion<=4)&&this.isAndroid?!0:navigator.userAgent.indexOf("MQQBrowser")>=0?!0:!1},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isWeiXin",{get:function(){var a=navigator.userAgent.toLowerCase();return"micromessenger"==a.match(/MicroMessenger/i)},enumerable:!0,configurable:!0}),Object.defineProperty(a.prototype,"isIPhone",{get:function(){return window.navigator.userAgent.indexOf("iPhone")>0},enumerable:!0,configurable:!0}),Object.defineProperty(a,"instance",{get:function(){return a._instance||(a._instance=new a),a._instance},enumerable:!0,configurable:!0}),a}(),g=function(){function b(){}return b.createControls=function(a,c){b.transformElement(a);for(var d=new Array,e=a.childNodes,f=0;f<e.length;f++){var g=e[f].nodeType;if(1==g){var h=b.createControl(e[f],c);null!=h&&d.push(h)}}return d},b.createControl=function(a,b){return i.createControl(a,b)},b.transformElement=function(c){var e=c;switch(e.tagName){case"SCROLL-VIEW":var g=a(e).attr("scroll-type");if(null==g&&(g=f.instance.isDegrade?d.doc:f.instance.isIOS?d.iscroll:f.instance.isAndroid&&f.instance.osVersion>=5?d.div:d.doc),g==d.iscroll){var h=document.createElement("scroller");h.innerHTML=e.innerHTML,e.innerHTML="",e.appendChild(h)}a(e).attr("scroll-type",g)}for(var i=0;i<c.childNodes.length;i++)b.transformElement(c.childNodes[i])},b}();b.ControlFactory=g;var h=function(){function a(a){this.parent=a,this.items=[]}return a.prototype.add=function(a){if(null==a)throw b.Errors.argumentNull("control");this[this.length]=this.items[this.items.length]=a,a.parent=this.parent},Object.defineProperty(a.prototype,"length",{get:function(){return this.items.length},enumerable:!0,configurable:!0}),a.prototype.item=function(a){if("number"==typeof a)return this.items[a];for(var b=a,c=0;c<this.items.length;c++)if(this.items[c].name==b)return this.items[c];return null},a}();b.ControlCollection=h;var i=function(){function c(c,d){if(this._children=new h(this),this.load=b.Callbacks(),null==c)throw b.Errors.argumentNull("element");if(null==d)throw b.Errors.argumentNull("page");this._element=c,this._page=d,this._name=a(c).attr("name"),a(c).data("control",this),this.createChildren(c,d)}return c.prototype.createChildren=function(a,b){for(var c=0;c<a.childNodes.length;c++)if(1==a.childNodes[c].nodeType){var d=this.createChild(a.childNodes[c],b);null!=d&&this.children.add(d)}},c.prototype.createChild=function(a,b){var c=g.createControl(a,b);return c},Object.defineProperty(c.prototype,"visible",{get:function(){var a=this.element.style.display;return"none"!=a},set:function(a){1==a?this.element.style.display="block":this.element.style.display="none"},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"element",{get:function(){return this._element},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"children",{get:function(){return this._children},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"name",{get:function(){return this._name},enumerable:!0,configurable:!0}),Object.defineProperty(c.prototype,"page",{get:function(){return this._page},enumerable:!0,configurable:!0}),c.prototype.fireEvent=function(a,c){return b.fireCallback(a,[this,c])},c.prototype.on_load=function(c){var d=new Array;d.push(this.fireEvent(this.load,c));for(var e=0;e<this.children.length;e++){var f=this.children.item(e).on_load(c);b.Utility.isDeferred(f)&&d.push(f)}var g=a.when.apply(a,d);return g},c.register=function(a,b){c.ControlTags[a]=b},c.createControl=function(a,d){if(null==a)throw b.Errors.argumentNull("element");if(null==d)throw b.Errors.argumentNull("page");var e=a.tagName,f=c.ControlTags[e];if(null==f)return null;var g;return g=null!=f.prototype?new f(a,d):f(a,d)},c.ControlTags={},c}();b.Control=i;var j=function(a){function b(b,c){a.call(this,b,c)}return e(b,a),b}(i);b.PageHeader=j;var k=function(a){function b(b,c){a.call(this,b,c)}return e(b,a),b}(i);b.PageFooter=k;var l=function(){function a(){}return a}();b.ScrollArguments=l;var m=function(c){function f(d,e){c.call(this,d,e),this.scroll=b.Callbacks(),this.scrollEnd=b.Callbacks(),this.scrollEnd.add(f.page_scrollEnd);var g=a(d).find("STATUS-BAR");g.length>0&&(this._bottomLoading=new p(g[0],e))}return e(f,c),f.prototype.on_load=function(b){var d;return null!=this.scrollLoad&&(d=this.scrollLoad(this,b)),d=null!=d?a.when(d,c.prototype.on_load.call(this,b)):c.prototype.on_load.call(this,b)},f.prototype.on_scrollEnd=function(a){return f.scrolling=!1,b.fireCallback(this.scrollEnd,[this,a])},f.prototype.on_scroll=function(a){return f.scrolling=!0,b.fireCallback(this.scroll,[this,a])},f.createInstance=function(b,c){var e=a(b).attr("scroll-type");return e==d.doc?new n(b,c):e==d.iscroll?new q(b,c):e==d.div?new o(b,c):new n(b,c)},Object.defineProperty(f.prototype,"bottomLoading",{get:function(){return this._bottomLoading},enumerable:!0,configurable:!0}),f.page_scrollEnd=function(a,b){var c=b.scrollTop,d=b.scrollHeight,e=b.clientHeight,f=e/3;if(!(d-f>e+c)&&null!=a.scrollLoad){var g=a.scrollLoad(a,b);g.done(function(){null!=a.bottomLoading&&(a.bottomLoading.visible=0!=b.enableScrollLoad)})}},f.scrolling=!1,f}(i);b.ScrollView=m;var n=function(b){function c(c,d){var e=this;b.call(this,c,d),this.cur_scroll_args=new l,this.CHECK_INTERVAL=300,a(document).scroll(function(b){var c=new l;c.scrollTop=a(document).scrollTop(),c.scrollHeight=document.body.scrollHeight,c.clientHeight=a(window).height(),e.cur_scroll_args.clientHeight=c.clientHeight,e.cur_scroll_args.scrollHeight=c.scrollHeight,e.cur_scroll_args.scrollTop=c.scrollTop,e.scrollEndCheck()})}return e(c,b),c.createElement=function(a,b){var c=document.createElement("div");return c.innerHTML=a,b.element.appendChild(c),c},c.prototype.scrollEndCheck=function(){var a=this;null==this.checking_num&&(this.checking_num=0,this.checking_num=window.setInterval(function(){return a.pre_scroll_top==a.cur_scroll_args.scrollTop?(window.clearInterval(a.checking_num),a.checking_num=null,a.pre_scroll_top=null,void a.on_scrollEnd(a.cur_scroll_args)):void(a.pre_scroll_top=a.cur_scroll_args.scrollTop)},this.CHECK_INTERVAL))},c}(m),o=function(a){function b(b,c){var d=this;a.call(this,b,c),this.cur_scroll_args=new l,this.CHECK_INTERVAL=30,this.element.onscroll=function(){d.cur_scroll_args.scrollTop=d.element.scrollTop,d.cur_scroll_args.clientHeight=d.element.clientHeight,d.cur_scroll_args.scrollHeight=d.element.scrollHeight,d.on_scroll(d.cur_scroll_args),d.scrollEndCheck()}}return e(b,a),b.prototype.scrollEndCheck=function(){var a=this;null==this.checking_num&&(this.checking_num=0,this.checking_num=window.setInterval(function(){return a.pre_scroll_top==a.cur_scroll_args.scrollTop?(window.clearInterval(a.checking_num),a.checking_num=null,a.pre_scroll_top=null,void a.on_scrollEnd(a.cur_scroll_args)):void(a.pre_scroll_top=a.cur_scroll_args.scrollTop)},this.CHECK_INTERVAL))},b}(m),p=function(a){function b(b,c){a.call(this,b,c),b.innerHTML='<div name="scrollLoad_loading" style="padding:10px 0px 10px 0px;">         <h5 class="text-center">                 <i class="icon-spinner icon-spin"></i><span style="padding-left:10px;">数据正在加载中...</span>             </h5>     </div>'}return e(b,a),b}(i);b.ScrollViewStatusBar=p;var q=function(b){function c(a,c){var d=this;b.call(this,a,c),requirejs(["iscroll"],function(){return d.init(d.element)})}return e(c,b),c.prototype.init=function(b){var c={tap:!0,useTransition:!1,HWCompositing:!1,preventDefault:!0,probeType:1},d=this.iscroller=new IScroll(b,c);d.page_container=this,d.on("scrollEnd",function(){var a=this,b={scrollTop:0-a.y,scrollHeight:a.scrollerHeight,clientHeight:a.wrapperHeight};e.on_scrollEnd(b)});var e=this;d.on("scroll",function(){var a=this,b={scrollTop:0-a.y,scrollHeight:a.scrollerHeight,clientHeight:a.wrapperHeight};e.on_scroll(b)}),function(b,c){a(c).on("tap",function(c){if(0!=b.enabled)for(var d=4,e=1,f=c.target;null!=f;){if("A"==f.tagName)return window.open(a(f).attr("href"),"_self");if(f=f.parentNode,e+=1,e>d)return}})}(d,b),a(window).on("resize",function(){window.setTimeout(function(){return d.refresh()},500)})},c.prototype.refresh=function(){null!=this.iscroller&&this.iscroller.refresh()},c}(m);b.IScrollView=q;var r=function(a){function c(b,c){a.call(this,b,c),this._loaded_count=0,this.loading_element=document.createElement("page-loading"),this.loading_element.className="page-loading",this.loading_element.innerHTML=this.defaultHtml(),b.appendChild(this.loading_element)}return e(c,a),c.prototype.defaultHtml=function(){var a='<div class="spin"><i class="icon-spinner icon-spin"></i><div>';return a},Object.defineProperty(c.prototype,"loaded_count",{set:function(a){if(this._loaded_count=this._loaded_count+1,this._loaded_count>=this.children.length){this.loading_element.style.display="none";for(var b=0;b<this.children.length;b++)this.children[b].visible=!0}},enumerable:!0,configurable:!0}),c.prototype.createChild=function(d,e){var f=this,g=a.prototype.createChild.call(this,d,e);return null!=g?(g.visible=!1,g.on_load=function(a){var d=c._on_load.apply(this,[a]);return b.Utility.isDeferred(d)?d.done(function(){return f.loaded_count=f.loaded_count+1}):f.loaded_count=f.loaded_count+1,d},g):void 0},c._on_load=i.prototype.on_load,c}(i);b.FormLoading=r,i.register("FORM-LOADING",r),i.register("HEADER",j),i.register("TOP-BAR",j),i.register("SCROLL-VIEW",m.createInstance),i.register("FOOTER",k),i.register("BOTTOM-BAR",k)}(d||(d={}));var d;!function(a){var b=function(){function b(){}return b.argumentNull=function(b){var c=a.Utility.format('The argument "{0}" cannt be null.',b);return new Error(c)},b.modelFileExpecteFunction=function(b){var c=a.Utility.format('The eval result of script file "{0}" is expected a function.',b);return new Error(c)},b.paramTypeError=function(b,c){var d=a.Utility.format('The param "{0}" is expected "{1}" type.',b,c);return new Error(d)},b.paramError=function(a){return new Error(a)},b.viewNodeNotExists=function(b){var c=a.Utility.format('The view node "{0}" is not exists.',b);return new Error(c)},b.pathPairRequireView=function(b){var c=a.Utility.format('The view value is required for path pair, but the item with index "{0}" is miss it.',b);return new Error(c)},b.notImplemented=function(b){var c=a.Utility.format('The method "{0}" is not implemented.',b);return new Error(c)},b.routeExists=function(b){var c=a.Utility.format('Route named "{0}" is exists.',b);return new Error(c)},b.routeResultRequireController=function(b){var c=a.Utility.format('The parse result of route "{0}" does not contains controler.',b);return new Error(c)},b.routeResultRequireAction=function(b){var c=a.Utility.format('The parse result of route "{0}" does not contains action.',b);return new Error(c)},b.ambiguityRouteMatched=function(b,c,d){var e=a.Utility.format("Ambiguity route matched, {0} is match in {1} and {2}.",b,c,d);return new Error(e)},b.noneRouteMatched=function(b){var c=a.Utility.format('None route matched with url "{0}".',b),d=new Error(c);return d},b.emptyStack=function(){return new Error("The stack is empty.")},b.canntParseUrl=function(b){var c=a.Utility.format('Can not parse the url "{0}" to route data.',b);return new Error(c)},b.routeDataRequireController=function(){var a='The route data does not contains a "controller" file.';return new Error(a)},b.routeDataRequireAction=function(){var a='The route data does not contains a "action" file.';return new Error(a)},b.parameterRequireField=function(b,c){var d=a.Utility.format("Parameter {1} does not contains field {0}.",b,c);return new Error(d)},b.viewCanntNull=function(){var a="The view or viewDeferred of the page cannt null.";return new Error(a)},b}();a.Errors=b}(d||(d={}));var d;!function(b){function c(a){var b=g[a]={};return jQuery.each(a.match(f)||[],function(a,c){b[c]=!0}),b}function d(a){void 0===a&&(a=null),a="string"==typeof a?g[a]||c(a):jQuery.extend({},a);var d,e,f,h,i,j,k=[],l=!a.once&&[],m=function(b){for(d=a.memory&&b,e=!0,j=h||0,h=0,i=k.length,f=!0;k&&i>j;j++){var c=k[j].apply(b[0],b[1]);if(null!=c&&b[0].results.push(c),c===!1&&a.stopOnFalse){d=!1;break}}f=!1,k&&(l?l.length&&m(l.shift()):d?k=[]:n.disable())},n={results:[],add:function(){if(k){var b=k.length;!function c(b){jQuery.each(b,function(b,d){var e=jQuery.type(d);"function"===e?a.unique&&n.has(d)||k.push(d):d&&d.length&&"string"!==e&&c(d)})}(arguments),f?i=k.length:d&&(h=b,m(d))}return this},remove:function(){return k&&jQuery.each(arguments,function(a,b){for(var c;(c=jQuery.inArray(b,k,c))>-1;)k.splice(c,1),f&&(i>=c&&i--,j>=c&&j--)}),this},has:function(a){return a?jQuery.inArray(a,k)>-1:!(!k||!k.length)},empty:function(){return k=[],i=0,this},disable:function(){return k=l=d=void 0,this},disabled:function(){return!k},lock:function(){return l=void 0,d||n.disable(),this},locked:function(){return!l},fireWith:function(a,b){return a.results=[],!k||e&&!l||(b=b||[],b=[a,b.slice?b.slice():b],f?l.push(b):m(b)),a.results},fire:function(){return n.fireWith(this,arguments)},fired:function(){return!!e},count:function(){return k.length}};return new b.Callback(n)}function e(c,d){for(var e=c.fire.apply(c,d),f=[],g=0;g<e.length;g++)b.Utility.isDeferred(e[g])&&f.push(e[g]);return 0==f.length?a.Deferred().resolve():a.when.apply(a,f)}var f=/\S+/g,g={},h=function(){function a(a){this.source=a}return a.prototype.add=function(a){this.source.add(a)},a.prototype.remove=function(a){this.source.remove(a)},a.prototype.has=function(a){return this.source.has(a)},a.prototype.fireWith=function(a,b){return this.source.fire(a,b)},a.prototype.fire=function(a,b,c,d){return this.source.fire(a,b,c)},a}();b.Callback=h,b.Callbacks=d,b.fireCallback=e}(d||(d={}));var d;!function(b){var c=b,d=(b.Utility,b.Errors);!function(a){a[a.init=0]="init",a[a.scroll=1]="scroll",a[a.pullDown=2]="pullDown",a[a.pullUp=3]="pullUp",a[a.custom=4]="custom"}(b.PageLoadType||(b.PageLoadType={}));var e;b.PageLoadType;!function(a){a[a.swipeLeft=0]="swipeLeft",a[a.swipeRight=1]="swipeRight",a[a.none=2]="none"}(e||(e={}));var f;!function(a){a[a.header=1]="header",a[a.body=2]="body",a[a.loading=4]="loading",a[a.footer=8]="footer"}(f||(f={}));var g;!function(a){a[a.open=0]="open",a[a.closed=1]="closed"}(g||(g={})),function(a){a[a.None=0]="None",a[a.Left=1]="Left",a[a.Right=2]="Right",a[a.Up=3]="Up",a[a.Down=4]="Down"}(b.SwipeDirection||(b.SwipeDirection={}));var h=b.SwipeDirection;!function(a){a[a.IScroll=0]="IScroll",a[a.Div=1]="Div",a[a.Document=2]="Document"}(b.ScrollType||(b.ScrollType={}));var i=(b.ScrollType,function(){function e(b,f,g,h){if(this._loadViewModelResult=null,this._openResult=null,this._hideResult=null,this._showTime=e.animationTime,this._hideTime=e.animationTime,this._enableScrollLoad=!1,this.is_closed=!1,this.isActionExecuted=!1,this.preLoad=c.Callbacks(),this.load=c.Callbacks(),this.loadCompleted=c.Callbacks(),this.closing=c.Callbacks(),this.closed=c.Callbacks(),this.showing=c.Callbacks(),this.shown=c.Callbacks(),this.hiding=c.Callbacks(),this.hidden=c.Callbacks(),this.viewChanged=c.Callbacks(),!b)throw d.argumentNull("container");if(null==f)throw d.argumentNull("scrorouteDatallType");this._pageContainer=b,this._node=document.createElement("page"),a(this._node).data("page",this),this._prevous=h,this._routeData=f}return e.prototype.createControls=function(a){this._controls=b.ControlFactory.createControls(a,this);for(var c=new Array,d=0;d<this._controls.length;d++)c.push(this._controls[d]);return this._controls},Object.defineProperty(e.prototype,"enableScrollLoad",{get:function(){return this._enableScrollLoad},set:function(a){this._enableScrollLoad=a},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"viewHtml",{get:function(){return this._viewHtml},set:function(a){this._viewHtml=a,this._controls=this.createControls(this.element),this.on_viewChanged({})},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"routeData",{get:function(){return this._routeData},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"name",{get:function(){return this._name||(this._name=this.routeData.pageName),this._name},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"element",{get:function(){return this._node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"previous",{get:function(){return this._prevous},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"visible",{get:function(){return a(this._node).is(":visible")},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"container",{get:function(){return this._pageContainer},enumerable:!0,configurable:!0}),e.prototype.hide=function(a){return a=a||h.None,this.container.hide(a)},e.prototype.findControl=function(a){if(!a)throw b.Errors.argumentNull("name");for(var c=new Array,d=0;d<this._controls.length;d++){var e=this._controls[d];c.push(e)}for(;c.length>0;){var e=c.pop();if(e.name==a)return e;for(var d=0;d<e.children.length;d++)c.push(e.children[d])}return null},e.prototype.fireEvent=function(a,c){return b.fireCallback(a,[this,c])},e.prototype.on_load=function(b){var c=new Array;c.push(this.fireEvent(this.load,b));for(var d=0;d<this._controls.length;d++){var e=this._controls[d].on_load(b);c.push(e)}var f=a.when.apply(a,c);return f},e.prototype.on_loadCompleted=function(a){this.fireEvent(this.loadCompleted,a)},e.prototype.on_closing=function(a){return this.fireEvent(this.closing,a)},e.prototype.on_closed=function(a){return this.fireEvent(this.closed,a)},e.prototype.on_showing=function(a){return this.fireEvent(this.showing,a)},e.prototype.on_shown=function(a){return this.fireEvent(this.shown,a)},e.prototype.on_hiding=function(a){return this.fireEvent(this.hiding,a)},e.prototype.on_hidden=function(a){return this.fireEvent(this.hidden,a)},e.prototype.on_viewChanged=function(a){return this.fireEvent(this.viewChanged,a)},e.animationTime=300,e}());b.Page=i}(d||(d={}));var d;!function(d){var e=(function(){function a(){}return a}(),function(){function a(){this.Div="div",this.IScroll="iscroll",this.Document="doc"}return a}(),function(){function e(a,b){this.animationTime=300,this._previousOffsetRate=.5,this.enableSwipeClose=!0,this.pageCreated=d.Callbacks(),this.is_closing=!1,this._node=this.createNode(),this._loading=this.createLoading(this._node),this._pages=new Array,this._previous=b,this._app=a,this.gesture=new h,this._enableSwipeBack()}return e.prototype.on_pageCreated=function(a){return d.fireCallback(this.pageCreated,[this,a])},e.prototype._enableSwipeBack=function(){var e=this,f=this;if(null!=f.previous&&0!=this.enableSwipeClose){var g,h,i=f.element,j=a(window).width()/2,k=35,l=f.gesture.createPan(f.element);l.start=function(a){i.style.webkitTransform="",i.style.transform="";var c=new WebKitCSSMatrix(f.previous.element.style.webkitTransform);if(g=c.m41,1==d.ScrollView.scrolling)return!1;var j=Math.atan(Math.abs(a.deltaY/a.deltaX))/3.14159265*180;if(j>k)return!1;var l=null!=f.previous&&0!=(a.direction&b.DIRECTION_RIGHT)&&(e.open_swipe==d.SwipeDirection.Left||e.open_swipe==d.SwipeDirection.Right);return 1==l&&(h=e.previous.visible,e.previous.visible=!0),l},l.left=function(a){return a.deltaX<=0?(c(i).x(0).duration(0).end(),void c(e.previous.element).x(g).duration(0).end()):(c(i).x(a.deltaX).duration(0).end(),void c(e.previous.element).x(g+a.deltaX*e._previousOffsetRate).duration(0).end())},l.right=function(a){c(i).x(a.deltaX).duration(0).end(),c(e.previous.element).x(g+a.deltaX*e._previousOffsetRate).duration(0).end()},l.end=function(a){return a.deltaX>j?void e._app.back():(c(i).x(0).duration(d.Page.animationTime).end(),void c(f.previous.element).x(g).duration(d.Page.animationTime).end(function(){return e.previous.visible=h}))}}},e.prototype.createNode=function(){return this._node=document.createElement("div"),this._node.className="page-container",this._node.style.display="none",document.body.appendChild(this._node),this._node},e.prototype.createLoading=function(a){var b=document.createElement("div");return b.className="page-loading",b.innerHTML='<div class="spin"><i class="icon-spinner icon-spin"></i><div>',a.appendChild(b),b},e.prototype.show=function(b){var e=this;if(1==this.visible)return a.Deferred().resolve();var f=a(this._node).width(),g=a(this._node).height();(0>=f||0>=g)&&(b=d.SwipeDirection.None);var h=30,i=a.Deferred(),j=function(){null!=e.previous&&(e.previous.visible=!1),i.resolve()};switch(this.open_swipe=b,b){case d.SwipeDirection.None:default:a(this._node).show(),j();break;case d.SwipeDirection.Down:c(this.element).y(0-g).duration(0).end(),a(this._node).show(),window.setTimeout(function(){c(e.element).y(0).duration(e.animationTime).end(j)},h);break;case d.SwipeDirection.Up:c(this.element).y(g).duration(0).end(),a(this._node).show(),window.setTimeout(function(){c(e.element).y(0).duration(e.animationTime).end(j)},h);break;case d.SwipeDirection.Right:c(this.element).x(0-f).duration(0).end(),a(this._node).show(),window.setTimeout(function(){null!=e.previous&&c(e.previous.element).x(f*e._previousOffsetRate).duration(e.animationTime).end(),c(e.element).x(0).duration(e.animationTime).end(j)},h);break;case d.SwipeDirection.Left:c(this.element).x(f).duration(0).end(),a(this._node).show(),window.setTimeout(function(){null!=e.previous&&c(e.previous.element).x(0-f*e._previousOffsetRate).duration(e.animationTime).end(),c(e.element).x(0).duration(e.animationTime).end(j)},h)}return i},e.prototype.hide=function(b){if(0==this.visible)return a.Deferred().resolve();var e=a(this._node).width(),f=a(this._node).height(),g=a.Deferred();switch(b){case d.SwipeDirection.None:default:null!=this.previous&&c(this.previous.element).x(0).duration(this.animationTime).end(),g.resolve();break;case d.SwipeDirection.Down:c(this.element).y(f).duration(this.animationTime).end(function(){return g.resolve()});break;case d.SwipeDirection.Up:c(this.element).y(0-f).duration(this.animationTime).end(function(){return g.resolve()});break;case d.SwipeDirection.Right:null!=this.previous&&c(this.previous.element).x(0).duration(this.animationTime).end(),c(this.element).x(e).duration(this.animationTime).end(function(){return g.resolve()});break;case d.SwipeDirection.Left:null!=this.previous&&c(this.previous.element).x(0).duration(this.animationTime).end(),c(this.element).x(0-e).duration(this.animationTime).end(function(){return g.resolve()})}return g},e.prototype.close=function(b){var c=this;this.is_closing||(this.is_closing=!0,this.hide(b).done(function(){a(c._node).remove()}))},e.prototype.showLoading=function(){this._loading.style.display="block"},e.prototype.hideLoading=function(){this._loading.style.display="none"},Object.defineProperty(e.prototype,"visible",{get:function(){return a(this._node).is(":visible")},set:function(b){b?a(this._node).show():a(this._node).hide()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"element",{get:function(){return this._node},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"currentPage",{get:function(){return this._currentPage},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"pages",{get:function(){return this._pages},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"previous",{get:function(){return this._previous},enumerable:!0,configurable:!0}),e.prototype.createActionDeferred=function(b){var c=b.actionPath,e=a.Deferred();return requirejs([c],function(c){if(!c)return console.warn(d.Utility.format("加载活动“{0}”失败。",b.pageName)),void e.reject();if(!a.isFunction(c))throw d.Errors.modelFileExpecteFunction(b.pageName);e.resolve(c)},function(a){return e.reject(a)}),e},e.prototype.createViewDeferred=function(b){var c=b.viewPath,d=a.Deferred(),e="http://";return c.substr(0,e.length).toLowerCase()==e?a.ajax({url:c}).done(function(a){null!=a?d.resolve(a):d.reject()}).fail(function(a){return d.reject(a)}):requirejs(["text!"+c],function(a){null!=a?d.resolve(a):d.reject()},function(a){return d.reject(a)}),d},e.prototype.createPage=function(b,c){var d,e=this,f=this.createViewDeferred(b),g=this.createActionDeferred(b),h=a.Deferred();return this._pages.length>0&&(d=this._pages[this._pages.length-1]),a.when(g,f).done(function(a,f){var g=new a(e,b,c,d);e.on_pageCreated(g),e._pages.push(g),e._pages[g.name]=g,h.resolve(g),g.element.innerHTML=f,g.viewHtml=f,g.on_load(b.parameters)}).fail(function(){h.reject()}),h},e.prototype.showPage=function(a,b,c){var d=this;return this.createPage(a,b).done(function(a){d.element.appendChild(a.element),d._currentPage=a,a.on_showing(a.routeData.parameters),d.show(c).done(function(){a.on_shown(a.routeData.parameters)}),a.loadCompleted.add(function(){return d.hideLoading()})})},e}());d.PageContainer=e;var f=function(){function a(a){this._app=a}return a.createInstance=function(a,b,c){return new e(a,c)},a}();d.PageContainerFactory=f;var g=function(){function a(a){this.cancel=!1}return a}();d.Pan=g;var h=function(){function c(){var a=this;this._prevent={pan:b.DIRECTION_NONE},this.prevent={pan:function(b){a._prevent.pan=b}},this.executedCount=0,this.hammersCount=0}return c.prototype.getHammer=function(c){var d=this,e=a(c).data("hammer");return null==e&&(e=new b.Manager(c),e.add(new b.Pan({direction:b.DIRECTION_HORIZONTAL})),a(c).data("hammer",e),this.hammersCount=this.hammersCount+1,e.on("pan",function(a){for(var c=d.getPans(e.element),f=c.length-1;f>=0;f--){var g=e.get("pan").state;null==c[f].started&&(g&b.STATE_BEGAN)==b.STATE_BEGAN&&(c[f].started=c[f].start(a));var h=!1,i=c[f].started;if(1==i&&((a.direction&b.DIRECTION_LEFT)==b.DIRECTION_LEFT&&null!=c[f].left?c[f].left(a):(a.direction&b.DIRECTION_RIGHT)==b.DIRECTION_RIGHT&&null!=c[f].right?c[f].right(a):(a.direction&b.DIRECTION_UP)==b.DIRECTION_UP&&null!=c[f].up?c[f].up(a):(a.direction&b.DIRECTION_DOWN)==b.DIRECTION_DOWN&&null!=c[f].down&&c[f].down(a),
(g&b.STATE_ENDED)==b.STATE_ENDED&&null!=c[f].end&&c[f].end(a),h=!0),(g&b.STATE_ENDED)==b.STATE_ENDED&&(c[f].started=null),1==h)break}})),e},c.prototype.getPans=function(b){var c=a(b).data("pans");return null==c&&(c=new Array,a(b).data("pans",c)),c},c.prototype.clear=function(){this._prevent.pan=b.DIRECTION_NONE},c.prototype.createPan=function(a){if(null==a)throw d.Errors.argumentNull("element");var b=(this.getHammer(a),new g(this)),c=this.getPans(a);return c.push(b),b},c}();d.Gesture=h}(d||(d={}));var d;return function(b){var c=b.Errors,d=function(){function b(){}return b.isType=function(a,b){for(var c in a.prototype)if(void 0===b[c])return!1;return!0},b.isDeferred=function(a){return null==a?!1:null!=a.pipe&&null!=a.always&&null!=a.done?!0:!1},b.format=function(a){for(var b=[],c=1;c<arguments.length;c++)b[c-1]=arguments[c];for(var d=0;d<b.length;d++)a=a.replace(new RegExp("\\{"+d+"\\}","g"),function(){return b[d]});return a},b.fileName=function(a,b){if(!a)throw c.argumentNull("url");b=b||!0,a=a.replace("http://","/");var d=a.replace(/^.*[\\\/]/,"");if(b===!0){var e=d.split(".");d=e[0]}return d},b.log=function(a,b){if(void 0===b&&(b=[]),window.console){if(null==b)return void console.log(a);var c=this.format.apply(this,arguments);console.log(c)}},b.loadjs=function(b){var c=a.Deferred();return requirejs(b,function(){for(var a=[],b=0;b<arguments.length;b++)a[b]=arguments[b];c.resolve.apply(c,a)}),c},b}();b.Utility=d}(d||(d={})),d});